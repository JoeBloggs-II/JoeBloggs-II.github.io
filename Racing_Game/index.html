<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2 Player Car Battle</title>
  <style>
    body { margin:0; overflow:hidden; background:#333; }
    canvas { display:block; margin:0 auto; background:#222; }
    #hud {
      position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 40px; color: white; font-family: sans-serif;
      font-size: 18px; font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="hud">
    <div id="p1Health">P1 Health: 100</div>
    <div id="p2Health">P2 Health: 100</div>
  </div>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    class Car {
      constructor(x, y, color, controls) {
        this.x = x; this.y = y;
        this.angle = 0;
        this.speed = 0;
        this.maxSpeed = 5;
        this.color = color;
        this.health = 100;
        this.controls = controls;
        this.width = 40; this.height = 20;
      }

      update(keys) {
        if (keys[this.controls.up]) this.speed = Math.min(this.speed + 0.2, this.maxSpeed);
        else this.speed *= 0.95; // friction
        if (keys[this.controls.down]) this.speed = Math.max(this.speed - 0.2, -this.maxSpeed/2);
        if (keys[this.controls.left]) this.angle -= 0.05 * this.speed;
        if (keys[this.controls.right]) this.angle += 0.05 * this.speed;

        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed;

        // Keep inside canvas
        this.x = Math.max(0, Math.min(canvas.width, this.x));
        this.y = Math.max(0, Math.min(canvas.height, this.y));
      }

      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle);
        ctx.fillStyle = this.color;
        ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
        ctx.restore();
      }

      getCorners() {
        const cos = Math.cos(this.angle), sin = Math.sin(this.angle);
        return [
          {x: this.x + cos*this.width/2 - sin*this.height/2, y: this.y + sin*this.width/2 + cos*this.height/2}, // front right
          {x: this.x + cos*this.width/2 + sin*this.height/2, y: this.y + sin*this.width/2 - cos*this.height/2}, // front left
          {x: this.x - cos*this.width/2 - sin*this.height/2, y: this.y - sin*this.width/2 + cos*this.height/2}, // back right
          {x: this.x - cos*this.width/2 + sin*this.height/2, y: this.y - sin*this.width/2 - cos*this.height/2}, // back left
        ];
      }
    }

    const keys = {};
    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);

    const car1 = new Car(200, 300, "red", {up:"w", down:"s", left:"a", right:"d"});
    const car2 = new Car(600, 300, "blue", {up:"ArrowUp", down:"ArrowDown", left:"ArrowLeft", right:"ArrowRight"});

    function checkCollision(c1, c2) {
      const dx = c1.x - c2.x;
      const dy = c1.y - c2.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < 40) { // simple overlap radius check
        const relativeSpeed = Math.abs(c1.speed - c2.speed);

        // Head-on check â†’ both take damage
        const dot = Math.cos(c1.angle - c2.angle);
        if (dot < -0.5) {
          const dmg = Math.floor(relativeSpeed * 5);
          c1.health -= dmg;
          c2.health -= dmg;
        } else {
          // Otherwise, faster car deals damage
          if (Math.abs(c1.speed) > Math.abs(c2.speed)) {
            c2.health -= Math.floor(Math.abs(c1.speed) * 5);
          } else if (Math.abs(c2.speed) > Math.abs(c1.speed)) {
            c1.health -= Math.floor(Math.abs(c2.speed) * 5);
          }
        }

        // Bounce back
        c1.speed *= -0.5;
        c2.speed *= -0.5;
      }
    }

    function gameLoop() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      car1.update(keys);
      car2.update(keys);

      checkCollision(car1, car2);

      car1.draw();
      car2.draw();

      document.getElementById("p1Health").textContent = "P1 Health: " + car1.health;
      document.getElementById("p2Health").textContent = "P2 Health: " + car2.health;

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
