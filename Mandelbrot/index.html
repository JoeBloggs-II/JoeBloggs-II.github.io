<!DOCTYPE html>
<html>
<body style="margin:0; overflow:hidden;">
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById("canvas");
const gl = canvas.getContext("webgl2");

// Resize canvas to max square size
function resizeCanvas() {
    const size = Math.min(window.innerWidth, window.innerHeight);
    canvas.width = size;
    canvas.height = size;
    gl.viewport(0, 0, size, size);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Vertex shader: full-screen rectangle
const vertexShaderSource = `#version 300 es
in vec2 a_position;
void main() {
  gl_Position = vec4(a_position, 0.0, 1.0);
}`;

// Fragment shader: Mandelbrot per pixel
const fragmentShaderSource = `#version 300 es
precision highp float;
out vec4 FragColor;
uniform vec2 iResolution;

vec3 mandelbrot(vec2 c) {
    vec2 z = vec2(0.0);
    int maxIter = 200;
    int i;
    for(i=0; i<maxIter; i++) {
        float x = (z.x*z.x - z.y*z.y) + c.x;
        float y = (2.0*z.x*z.y) + c.y;
        z = vec2(x, y);
        if(dot(z,z) > 4.0) break;
    }
    float t = float(i)/float(maxIter);
    return vec3(t, t*t, t*t*t); // color gradient
}

void main() {
    vec2 uv = (gl_FragCoord.xy / iResolution) * 3.0 - vec2(2.0, 1.5); 
    // Keep aspect square
    uv.x *= iResolution.x / iResolution.y;
    vec3 color = mandelbrot(uv);
    FragColor = vec4(color, 1.0);
}`;

// Compile shader helper
function compileShader(gl, type, source) {
    const shader = gl.createShader(type);
    gl.shaderSource(shader, source);
    gl.compileShader(shader);
    if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
        console.error(gl.getShaderInfoLog(shader));
    }
    return shader;
}

// Create program
const vertexShader = compileShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
const fragmentShader = compileShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);
const program = gl.createProgram();
gl.attachShader(program, vertexShader);
gl.attachShader(program, fragmentShader);
gl.linkProgram(program);
gl.useProgram(program);

// Full-screen rectangle
const positionBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
  -1, -1, 1, -1, -1, 1,
  -1, 1, 1, -1, 1, 1
]), gl.STATIC_DRAW);

const positionLocation = gl.getAttribLocation(program, "a_position");
gl.enableVertexAttribArray(positionLocation);
gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

// Set uniform
const resLoc = gl.getUniformLocation(program, "iResolution");
gl.uniform2f(resLoc, canvas.width, canvas.height);

// Draw
gl.drawArrays(gl.TRIANGLES, 0, 6);
</script>
</body>
</html>
